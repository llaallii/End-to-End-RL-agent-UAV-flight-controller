%% D4.4 - Phase Dependencies Network (DAG)
%% UAV Flight Controller with On-Board Reinforcement Learning
%% Priority 2 - Critical Path Analysis
%% Placement: 00_WBS_Master_Overview.md (Section 2)

graph TD
    %% Phase 1 Dependencies
    P1_Req[1.1 Requirements<br/>Management]
    P1_CICD[1.2 Version Control<br/>& CI/CD]
    P1_Docs[1.3 Documentation<br/>Framework]
    P1_Gate[1.4 Stage Gate<br/>Procedures]
    
    %% Phase 2 Dependencies
    P2_Sim[2.1 Simulation<br/>Environment]
    P2_Dyn[2.2 UAV Dynamics<br/>Model]
    P2_Sen[2.3 Sensor<br/>Simulation]
    P2_PID[2.4 Baseline<br/>Controller]
    P2_Ver[2.5 SITL<br/>Verification]
    P2_Gate[2.6 Stage 1→2<br/>Gate]
    
    %% Phase 3 Dependencies
    P3_FW[3.1 RL Framework<br/>Integration]
    P3_Env[3.2 Training<br/>Environment]
    P3_Arch[3.3 Policy<br/>Architecture]
    P3_Train[3.4 Training &<br/>Tuning]
    P3_Eval[3.5 Performance<br/>Evaluation]
    P3_Comp[3.6 Policy<br/>Compression]
    P3_Gate[3.7 Stage 2→3<br/>Gate]
    
    %% Phase 4 Dependencies
    P4_MCU[4.1 MCU Selection<br/>& Procurement]
    P4_FWArch[4.2 Firmware<br/>Architecture]
    P4_Port[4.3 RL Inference<br/>Porting]
    P4_HIL[4.4 HIL Interface<br/>Development]
    P4_RT[4.5 Real-Time<br/>Validation]
    P4_Safe[4.6 Safety & Fault<br/>Handling]
    P4_Gate[4.7 Stage 3→4<br/>Gate]
    
    %% Phase 5 Dependencies
    P5_Req[5.1 Requirements<br/>Specification]
    P5_Sch[5.2 Schematic<br/>Design]
    P5_PCB[5.3 PCB<br/>Layout]
    P5_BOM[5.4 BOM &<br/>Sourcing]
    P5_Fab[5.5 Fabrication<br/>& Assembly]
    P5_Bring[5.6 Hardware<br/>Bring-Up]
    P5_Gate[5.7 Stage 4→Int<br/>Gate]
    
    %% Phase 6 Dependencies
    P6_Test[6.1 End-to-End<br/>Testing]
    P6_Docs[6.2 Documentation<br/>Completion]
    P6_Transfer[6.3 Knowledge<br/>Transfer]
    
    %% Phase 1 Internal Dependencies
    P1_Req --> P1_Gate
    P1_CICD --> P1_Gate
    P1_Docs --> P1_Gate
    
    %% Phase 1 → 2 Dependencies
    P1_Gate --> P2_Sim
    P1_CICD --> P2_Sim
    P1_Docs --> P2_Ver
    
    %% Phase 2 Internal Dependencies
    P2_Sim --> P2_Dyn
    P2_Sim --> P2_Sen
    P2_Dyn --> P2_PID
    P2_Sen --> P2_PID
    P2_PID --> P2_Ver
    P2_Ver --> P2_Gate
    
    %% Phase 2 → 3 Dependencies
    P2_Gate --> P3_FW
    P2_Ver --> P3_Env
    P2_PID -.->|"Baseline comparison"| P3_Eval
    
    %% Phase 3 Internal Dependencies
    P3_FW --> P3_Env
    P2_Sim --> P3_Env
    P3_Env --> P3_Arch
    P3_Arch --> P3_Train
    P3_Train --> P3_Eval
    P3_Eval -.->|"Iterate if needed"| P3_Train
    P3_Eval --> P3_Comp
    P3_Comp --> P3_Gate
    
    %% Phase 3 → 4 Dependencies
    P3_Gate --> P4_MCU
    P3_Comp --> P4_Port
    P2_Sim --> P4_HIL
    
    %% Phase 4 Internal Dependencies
    P4_MCU --> P4_FWArch
    P4_FWArch --> P4_Port
    P4_FWArch --> P4_HIL
    P4_Port --> P4_RT
    P4_HIL --> P4_RT
    P4_FWArch --> P4_Safe
    P4_RT --> P4_Gate
    P4_Safe --> P4_Gate
    
    %% Phase 4 → 5 Dependencies (Parallel)
    P4_Gate --> P5_Req
    P4_MCU -.->|"MCU selection informs HW design"| P5_Req
    P4_FWArch -.->|"Interface requirements"| P5_Req
    
    %% Phase 5 Internal Dependencies
    P5_Req --> P5_Sch
    P5_Sch --> P5_PCB
    P5_Sch --> P5_BOM
    P5_PCB --> P5_Fab
    P5_BOM --> P5_Fab
    P5_Fab --> P5_Bring
    P4_Gate -.->|"Firmware ready for HW"| P5_Bring
    P5_Bring --> P5_Gate
    
    %% Phase 5 → 6 Dependencies
    P5_Gate --> P6_Test
    P2_Ver -.->|"SITL baseline"| P6_Test
    P4_Gate -.->|"HIL validation"| P6_Test
    
    %% Phase 6 Internal Dependencies
    P6_Test --> P6_Docs
    P1_Docs -.->|"Doc framework"| P6_Docs
    P6_Docs --> P6_Transfer
    
    %% Critical Path Highlighting
    linkStyle 0,1,2,3,4,5,6,7,8,9,10,13,14,15,16,17,22,23,24,25,26,30,31,32,33,34 stroke:#D0021B,stroke-width:3px
    
    %% Styling by Phase
    classDef phase1 fill:#F5A623,stroke:#333,stroke-width:2px,color:#000
    classDef phase2 fill:#4A90E2,stroke:#333,stroke-width:2px,color:#fff
    classDef phase3 fill:#9013FE,stroke:#333,stroke-width:2px,color:#fff
    classDef phase4 fill:#7ED321,stroke:#333,stroke-width:2px,color:#000
    classDef phase5 fill:#50E3C2,stroke:#333,stroke-width:2px,color:#000
    classDef phase6 fill:#BD10E0,stroke:#333,stroke-width:2px,color:#fff
    classDef gate fill:#D0021B,stroke:#333,stroke-width:3px,color:#fff
    
    class P1_Req,P1_CICD,P1_Docs phase1
    class P2_Sim,P2_Dyn,P2_Sen,P2_PID,P2_Ver phase2
    class P3_FW,P3_Env,P3_Arch,P3_Train,P3_Eval,P3_Comp phase3
    class P4_MCU,P4_FWArch,P4_Port,P4_HIL,P4_RT,P4_Safe phase4
    class P5_Req,P5_Sch,P5_PCB,P5_BOM,P5_Fab,P5_Bring phase5
    class P6_Test,P6_Docs,P6_Transfer phase6
    class P1_Gate,P2_Gate,P3_Gate,P4_Gate,P5_Gate gate

%% Critical Path (bold red arrows):
%% P1_Req → P1_Gate → P2_Sim → P2_Dyn → P2_PID → P2_Ver → P2_Gate →
%% P3_FW → P3_Env → P3_Arch → P3_Train → P3_Eval → P3_Comp → P3_Gate →
%% P4_MCU → P4_FWArch → P4_Port → P4_RT → P4_Gate →
%% P5_Req → P5_Sch → P5_PCB → P5_Fab → P5_Bring → P5_Gate →
%% P6_Test → P6_Docs → P6_Transfer
%%
%% Parallel Opportunities:
%% - P1.2 (CI/CD) || P1.1 (Requirements) || P1.3 (Docs)
%% - P2.3 (Sensors) || P2.2 (Dynamics) (both after P2.1)
%% - P4.4 (HIL) || P4.2 (Firmware) (both after P4.1)
%% - P5 can start early (after P4.1) while P4 completes
%% - P6.2 (Docs) || P6.1 (Testing) overlap possible
