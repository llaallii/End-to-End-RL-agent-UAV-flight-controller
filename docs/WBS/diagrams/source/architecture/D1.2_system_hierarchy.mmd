%% D1.2 - System Hierarchy Decomposition (WBS Visual Tree)
%% UAV Flight Controller with On-Board Reinforcement Learning
%% Priority 1 - Foundation Diagram
%% Placement: 00_WBS_Master_Overview.md (Section 2)

graph TD
    %% Root
    Root["üöÅ UAV Flight Controller<br/>RL Project"]
    
    %% Level 1: Phases
    Root --> Phase1["1.0 Project Management<br/>& Infrastructure<br/>(2 weeks, 120h)"]
    Root --> Phase2["2.0 SITL Baseline<br/>System<br/>(8-10 weeks, 280h)"]
    Root --> Phase3["3.0 RL Control<br/>System<br/>(10-12 weeks, 320h)"]
    Root --> Phase4["4.0 HIL Flight<br/>Control<br/>(6-8 weeks, 240h)"]
    Root --> Phase5["5.0 Custom<br/>Hardware<br/>(10-14 weeks, 200h)"]
    Root --> Phase6["6.0 Integration<br/>& Validation<br/>(3-4 weeks, 80h)"]
    
    %% Phase 1 - Infrastructure (Level 2)
    Phase1 --> P1_1["1.1 Requirements<br/>Management"]
    Phase1 --> P1_2["1.2 Version Control<br/>& CI/CD"]
    Phase1 --> P1_3["1.3 Documentation<br/>Framework"]
    Phase1 --> P1_4["1.4 Stage Gate<br/>Reviews"]
    
    %% Phase 2 - SITL (Level 2)
    Phase2 --> P2_1["2.1 Simulation<br/>Environment"]
    Phase2 --> P2_2["2.2 UAV Dynamics<br/>Model"]
    Phase2 --> P2_3["2.3 Sensor<br/>Simulation"]
    Phase2 --> P2_4["2.4 Baseline<br/>Controller"]
    Phase2 --> P2_5["2.5 SITL<br/>Verification"]
    Phase2 --> P2_6["2.6 Stage 1‚Üí2<br/>Gate"]
    
    %% Phase 3 - RL (Level 2)
    Phase3 --> P3_1["3.1 RL Framework<br/>Integration"]
    Phase3 --> P3_2["3.2 Training<br/>Environment"]
    Phase3 --> P3_3["3.3 Policy<br/>Architecture"]
    Phase3 --> P3_4["3.4 Training &<br/>Tuning"]
    Phase3 --> P3_5["3.5 Performance<br/>Evaluation"]
    Phase3 --> P3_6["3.6 Policy<br/>Compression"]
    Phase3 --> P3_7["3.7 Stage 2‚Üí3<br/>Gate"]
    
    %% Phase 4 - HIL (Level 2)
    Phase4 --> P4_1["4.1 MCU Selection<br/>& Procurement"]
    Phase4 --> P4_2["4.2 Firmware<br/>Architecture"]
    Phase4 --> P4_3["4.3 RL Inference<br/>Porting"]
    Phase4 --> P4_4["4.4 HIL Interface<br/>Development"]
    Phase4 --> P4_5["4.5 Real-Time<br/>Validation"]
    Phase4 --> P4_6["4.6 Safety & Fault<br/>Handling"]
    Phase4 --> P4_7["4.7 Stage 3‚Üí4<br/>Gate"]
    
    %% Phase 5 - Hardware (Level 2)
    Phase5 --> P5_1["5.1 Requirements<br/>Specification"]
    Phase5 --> P5_2["5.2 Schematic<br/>Design"]
    Phase5 --> P5_3["5.3 PCB<br/>Layout"]
    Phase5 --> P5_4["5.4 BOM &<br/>Sourcing"]
    Phase5 --> P5_5["5.5 Fabrication<br/>& Assembly"]
    Phase5 --> P5_6["5.6 Hardware<br/>Bring-Up"]
    Phase5 --> P5_7["5.7 Stage 4‚ÜíInt<br/>Gate"]
    
    %% Phase 6 - Integration (Level 2)
    Phase6 --> P6_1["6.1 End-to-End<br/>Testing"]
    Phase6 --> P6_2["6.2 Documentation<br/>Completion"]
    Phase6 --> P6_3["6.3 Knowledge<br/>Transfer"]
    
    %% Example Level 3 for Phase 2.1 (expandable)
    P2_1 --> P2_1_1["2.1.1 Gazebo Install"]
    P2_1 --> P2_1_2["2.1.2 ROS Setup"]
    P2_1 --> P2_1_3["2.1.3 World Design"]
    P2_1 --> P2_1_4["2.1.4 Physics Tuning"]
    
    %% Example Level 3 for Phase 3.4 (Training)
    P3_4 --> P3_4_1["3.4.1 Training<br/>Iteration 1"]
    P3_4 --> P3_4_2["3.4.2 Analysis &<br/>Adjustment"]
    P3_4 --> P3_4_3["3.4.3 Training<br/>Iteration 2"]
    P3_4 --> P3_4_6["3.4.6 Convergence<br/>Validation"]
    
    %% Styling by Phase
    classDef phase1 fill:#F5A623,stroke:#333,stroke-width:3px,color:#000
    classDef phase2 fill:#4A90E2,stroke:#333,stroke-width:3px,color:#fff
    classDef phase3 fill:#9013FE,stroke:#333,stroke-width:3px,color:#fff
    classDef phase4 fill:#7ED321,stroke:#333,stroke-width:3px,color:#000
    classDef phase5 fill:#50E3C2,stroke:#333,stroke-width:3px,color:#000
    classDef phase6 fill:#BD10E0,stroke:#333,stroke-width:3px,color:#fff
    classDef root fill:#D0021B,stroke:#333,stroke-width:4px,color:#fff
    
    class Root root
    class Phase1,P1_1,P1_2,P1_3,P1_4 phase1
    class Phase2,P2_1,P2_2,P2_3,P2_4,P2_5,P2_6,P2_1_1,P2_1_2,P2_1_3,P2_1_4 phase2
    class Phase3,P3_1,P3_2,P3_3,P3_4,P3_5,P3_6,P3_7,P3_4_1,P3_4_2,P3_4_3,P3_4_6 phase3
    class Phase4,P4_1,P4_2,P4_3,P4_4,P4_5,P4_6,P4_7 phase4
    class Phase5,P5_1,P5_2,P5_3,P5_4,P5_5,P5_6,P5_7 phase5
    class Phase6,P6_1,P6_2,P6_3 phase6

%% Notes:
%% - Complete WBS hierarchy from sections 2.1-2.6
%% - Color coded by phase for easy navigation
%% - Shows duration and effort estimates at Level 1
%% - Level 3 examples for two critical subsystems
%% - Can be expanded to show all Level 3 and 4 tasks
